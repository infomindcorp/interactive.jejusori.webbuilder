(function(c){var a=(c.browser.msie?"paste":"input")+".mask";var b=(window.orientation!=undefined);c.mask={definitions:{"0":"[0]","1":"[0-1]","2":"[0-2]","3":"[0-3]","4":"[0-4]","5":"[0-5]","6":"[0-6]","7":"[0-7]","8":"[0-8]","9":"[0-9]",z:"[a-z]",Z:"[A-Z]",a:"[A-Za-z]","*":"[A-Za-z0-9]"},dataName:"rawMaskFn"};c.fn.extend({caret:function(f,d){if(this.length==0){return}if(typeof f=="number"){d=(typeof d=="number")?d:f;return this.each(function(){if(this.setSelectionRange){try{this.setSelectionRange(f,d)}catch(h){}}else{if(this.createTextRange){var g=this.createTextRange();g.collapse(true);g.moveEnd("character",d);g.moveStart("character",f);g.select()}}})}else{if(this[0].setSelectionRange){f=this[0].selectionStart;d=this[0].selectionEnd}else{if(document.selection&&document.selection.createRange){var e=document.selection.createRange();f=0-e.duplicate().moveStart("character",-100000);d=f+e.text.length}}return{begin:f,end:d}}},unmask:function(){return this.trigger("unmask")},mask:function(e,k){if(!e&&this.length>0){var g=c(this[0]);return g.data(c.mask.dataName)()}k=c.extend({placeholder:"_",completed:null,clearOnError:true},k);var f=c.mask.definitions;var i=[];var h=e.length;var d=null;var j=e.length;c.each(e.split(""),function(l,m){if(m=="?"){j--;h=l}else{if(f[m]){i.push(new RegExp(f[m]));if(d==null){d=i.length-1}}else{i.push(null)}}});return this.trigger("unmask").each(function(){var r=c(this);var m=c.map(e.split(""),function(x,y){if(x!="?"){return f[x]?k.placeholder:x}});var p=r.val();function u(x){while(++x<=j&&!i[x]){}return x}function v(x){while(--x>=0&&!i[x]){}return x}function l(x,y){if(x<0){return}for(var z=x,A=u(y);z<j;z++){if(i[z]){if(A<j&&i[z].test(m[A])){m[z]=m[A];m[A]=k.placeholder}else{break}A=u(A)}}o();r.caret(Math.max(d,x))}function q(A){for(var z=A,x=k.placeholder;z<j;z++){if(i[z]){var B=u(z);var y=m[z];m[z]=x;if(B<j&&i[B].test(y)){x=y}else{break}}}}function w(A){var x=A.which;if(x==8||x==46||(b&&x==127)){var B=r.caret(),z=B.begin,y=B.end;if(y-z==0){z=x!=46?v(z):(y=u(z-1));y=x==46?u(y):y}n(z,y);l(z,y-1);return false}else{if(x==27){r.val(p);r.caret(0,t());return false}}}function s(B){var z=B.which,C=r.caret();if(B.ctrlKey||B.altKey||B.metaKey||z<32){return true}else{if(z){if(C.end-C.begin!=0){n(C.begin,C.end);l(C.begin,C.end-1)}var x=u(C.begin-1);if(x<j){var A=String.fromCharCode(z);if(i[x].test(A)){q(x);m[x]=A;o();var y=u(x);r.caret(y);if(k.completed&&y>=j){k.completed.call(r)}}}return false}}}function n(z,x){for(var y=z;y<x&&y<j;y++){if(i[y]){m[y]=k.placeholder}}}function o(){return r.val(m.join("")).val()}function t(x){var z=r.val();var B=-1;for(var y=0,C=0;y<j;y++){if(i[y]){m[y]=k.placeholder;while(C++<z.length){var A=z.charAt(C-1);if(i[y].test(A)){m[y]=A;B=y;break}}if(C>z.length){break}}else{if(m[y]==z.charAt(C)&&y!=h){C++;B=y}}}if(!x&&B+1<h&&k.clearOnError){r.val("");n(0,j)}else{if(x||B+1>=h){o();if(!x){r.val(r.val().substring(0,B+1))}}}return(h?y:d)}r.data(c.mask.dataName,function(){return c.map(m,function(x,y){return i[y]&&x!=k.placeholder?x:null}).join("")});r.one("unmask",function(){r.unbind(".mask").removeData(c.mask.dataName)}).bind("blur.mask",function(){t();if(r.val()!=p){r.change()}});if(!r.attr("readonly")){r.bind("focus.mask",function(){p=r.val();var x=t();o();var y=function(){if(x==e.length){r.caret(0,x)}else{r.caret(x)}};(c.browser.msie?y:function(){setTimeout(y,0)})()}).bind("keydown.mask",w).bind("keypress.mask",s).bind(a,function(){setTimeout(function(){r.caret(t(true))},0)})}t()})}})})(jQuery);